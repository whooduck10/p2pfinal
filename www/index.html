<!doctype html>
<html>
<head>
    <title>Peer Tracker Dashboard</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
<div class="container">

    <h1 class="title">Peer Tracker Dashboard</h1>
    <p class="subtitle">Manage peer registration, status, and active list</p>

    <img src="images/welcome.png" alt="Welcome" class="hero-image">

    <hr>

    <h2 class="section-title">Register / Manage Peer</h2>
    <div class="input-row">
        <input id="ip" placeholder="Enter Peer IP">
        <input id="port" placeholder="Enter Peer Port">
    </div>

    <div class="button-row">
        <button class="btn primary" onclick="submitInfo()">Register</button>
        <button class="btn success" onclick="addList()">Go Online</button>
        <button class="btn danger" onclick="remove()">Go Offline</button>
    </div>

    <hr>

    <h2 class="section-title">Active Peer List</h2>
    <button class="btn secondary full" onclick="getList()">Refresh Peer List</button>
    <button onclick="chat()">Start Chatting</button>
    <div id="peerTable" class="table-container"></div>
</div>

<div id="popup"></div>

<script>

function chat() {
    window.location.href = 'chat.html';
}
function showPopup(msg, isError = false) {
    const popup = document.getElementById('popup');
    popup.textContent = msg;
    popup.style.background = isError ? '#e53935' : '#4CAF50';
    popup.style.display = 'block';
    setTimeout(() => popup.style.display = 'none', 1500);
}

async function submitInfo() {
    const ip = document.getElementById('ip').value;
    const port = document.getElementById('port').value;

    const res = await fetch('/submit-info', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ip, port })
    });
    const data = await res.json();
    if (data.error) return showPopup(data.error, true);
    showPopup(`${data.peer_id} registered`);
}

async function addList() {
    const ip = document.getElementById('ip').value;
    const port = document.getElementById('port').value;

    const res = await fetch('/add-list', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ip, port })
    });
    const data = await res.json();
    if (data.error) return showPopup(data.error, true);
    showPopup(`${data.peer_id} is now online`);
}

async function remove() {
    const ip = document.getElementById('ip').value;
    const port = document.getElementById('port').value;

    const res = await fetch('/remove', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ip, port })
    });
    const data = await res.json();
    if (data.error) return showPopup(data.error, true);
    showPopup(`${data.peer_id} is now offline`);
}

async function getList() {
    const res = await fetch('/get-list');
    const data = await res.json();

    let html = `
        <table>
            <tr>
                <th>IP Address</th>
                <th>Port</th>
            </tr>
    `;

    for (const peerId in data.peer_list) {
        const peer = data.peer_list[peerId];
        html += `
            <tr>
                <td>${peer.ip}</td>
                <td>${peer.port}</td>
            </tr>
        `;
    }

    html += '</table>';
    document.getElementById('peerTable').innerHTML = html;
}
</script>

</body>
</html>
